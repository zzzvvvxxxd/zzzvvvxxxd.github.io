<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>zzzvvvxxxd</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="zzzvvvxxxd">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="zzzvvvxxxd">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="zzzvvvxxxd">
  
    <link rel="alternate" href="/atom.xml" title="zzzvvvxxxd" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">zzzvvvxxxd</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">最快的外卖小哥</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Future" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/03/Future/" class="article-date">
  <time datetime="2017-03-03T11:16:16.000Z" itemprop="datePublished">2017-03-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>title: Future笔记<br>date: 2017-03-02 19:17:21<br>categories: Java,JDK</p>
<h2 id="tags-Java-JDK"><a href="#tags-Java-JDK" class="headerlink" title="tags: [Java,JDK]"></a>tags: [Java,JDK]</h2><h2 id="1-JDK5"><a href="#1-JDK5" class="headerlink" title="1. JDK5+"></a>1. JDK5+</h2><ul>
<li><code>Future</code> 只能通过轮询的方式进行查询</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Future</span>&lt;<span class="title">V</span>&gt; </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">cancel</span><span class="params">(<span class="keyword">boolean</span> mayInterruptIfRunning)</span></span>;</div><div class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">isCancelled</span><span class="params">()</span></span>;</div><div class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">isDone</span><span class="params">()</span></span>;</div><div class="line">  <span class="function">V <span class="title">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="2-Guava"><a href="#2-Guava" class="headerlink" title="2. Guava"></a>2. Guava</h2><ul>
<li><code>ListenableFuture</code>提供<code>addListener()</code>和<code>addCallback()</code>的方式进行回调</li>
</ul>
<p><code>ListenableFuture</code>继承自<code>Future</code>，可以通过<code>addListener</code>添加Listener</p>
<p>Guava还提供了一些Util函数：</p>
<ol>
<li><code>addCallback</code>在某个<code>ListenableFuture</code>上添加Callback</li>
<li><code>transform</code>可以把一个<code>ListenerFuture</code>通过一个Function变成另外一个ListenerFuture</li>
</ol>
<h2 id="3-JDK8"><a href="#3-JDK8" class="headerlink" title="3. JDK8"></a>3. JDK8</h2><ul>
<li><code>CompleteableFuture</code>（提供了较为完整的<code>Future</code>支持）</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/03/Future/" data-id="cj65v1lc50005d7f96yhevfgu" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ZAB2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/22/ZAB2/" class="article-date">
  <time datetime="2016-08-21T17:26:47.000Z" itemprop="datePublished">2016-08-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/分布式/">分布式</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/22/ZAB2/">【一致性协议05】 ZAB协议详细介绍</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、消息广播"><a href="#一、消息广播" class="headerlink" title="一、消息广播"></a>一、消息广播</h2><h3 id="1-1-类似二阶段提交的消息广播"><a href="#1-1-类似二阶段提交的消息广播" class="headerlink" title="1.1 类似二阶段提交的消息广播"></a>1.1 类似二阶段提交的消息广播</h3><p>ZAB协议的消息广播过程本质就是一个简单的原子广播协议，类似于<code>2PC</code>。针对客户端的事务请求，Leader服务器会为其是生成对应的事务<code>Proposal</code>，并将其发送给集群中其余的所有机器，然后再分别收集各自的选票，最后进行事务提交。<br><img src="https://raw.githubusercontent.com/zzzvvvxxxd/Picture/master/hexo/ZAB%E6%B6%88%E6%81%AF%E5%B9%BF%E6%92%AD.JPG" alt="ZAB协议消息广播流程示意图"></p>
<p>和<code>2PC</code>略有不同，这里的二阶段提交过程移除了中断（abort）逻辑。所有的Follower要么正常反馈，要么就抛弃Leader服务器。同时ZAB协议将二阶段提交中的中断逻辑移除意味着我们可以在过半的Follower服务器已经反馈<code>Ack</code>之后就开始提交<code>Proposal</code>了，而不需要等待集群中的所有Follower服务器都反馈响应。    </p>
<p>在这种简化的二阶段提交模型下，无法处理Leader服务器崩溃带来的数据不一致问题，因此引入了<strong>崩溃回复模式</strong>。  </p>
<h3 id="1-2-ZXID"><a href="#1-2-ZXID" class="headerlink" title="1.2 ZXID"></a>1.2 ZXID</h3><p>Leader会为每个事物Proposal分配一个全局唯一的单调递增ID：<code>ZXID</code>（事务ID）。由于ZAB协议要保证每一个消息严格的因果关系，因此必须将每一个事务Proposal按照其<code>ZXID</code>先后顺序来进行排序与处理：</p>
<h3 id="1-3-具体流程"><a href="#1-3-具体流程" class="headerlink" title="1.3 具体流程"></a>1.3 具体流程</h3><ul>
<li>Leader为每一个Follower服务器分配一个单独的队列，然后将需要广播的事务Proposal依次放入队列中，并且根据FIFO策略进行消息发送。</li>
<li>Follower接受到Proposal之后，都会首先将其以事务日志的形式写入到本地磁盘中去，并且在成功写入后反馈给Leader一个Ack</li>
<li>当接收到超过半数Follower反馈Ack之后，就会广播一个Commit消息给所有Follower来通知事务提交，同时Leader自身提交该事务</li>
<li>Follower收到<code>commit</code>之后进行事务提交</li>
</ul>
<h2 id="二、崩溃恢复"><a href="#二、崩溃恢复" class="headerlink" title="二、崩溃恢复"></a>二、崩溃恢复</h2><h3 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h3><ul>
<li>Leader崩溃</li>
<li>网络原因导致Leader失去与过半Follower的联系</li>
</ul>
<p>则进入崩溃恢复模式。恢复过程结束后，还需要选举出新的Leader。Leader选举算法满足：</p>
<ul>
<li>确保能够快速地选举出新的Leader</li>
<li>Leader自身知道已经被选举为Leader</li>
<li>让集群中其他的机器快速感知到新的Leader服务器</li>
</ul>
<h3 id="2-2-基本特性"><a href="#2-2-基本特性" class="headerlink" title="2.2 基本特性"></a>2.2 基本特性</h3><p>ZAB协议规定：</p>
<blockquote>
<p>如果一个事务Proposal在一台机器上被处理成功，那么应该在所有的机器上都被处理成功，哪怕机器出现故障崩溃。</p>
</blockquote>
<p>在崩溃恢复过程中可能会出现两种数据不一致的隐患：</p>
<h4 id="2-2-1-ZAB协议需要确保那些已经在Leader服务器上提交的事务最终被所有服务器都提交"><a href="#2-2-1-ZAB协议需要确保那些已经在Leader服务器上提交的事务最终被所有服务器都提交" class="headerlink" title="2.2.1 ZAB协议需要确保那些已经在Leader服务器上提交的事务最终被所有服务器都提交"></a>2.2.1 ZAB协议需要确保那些已经在Leader服务器上提交的事务最终被所有服务器都提交</h4><p><img src="https://raw.githubusercontent.com/zzzvvvxxxd/Picture/master/hexo/ZAB%E5%B4%A9%E6%BA%83%E6%81%A2%E5%A4%8D1.JPG" alt="崩溃恢复1"><br>Leader(Server1)已经得到过半的<code>Ack</code>反馈，但是在它将<code>Commit</code>消息发送给所有Follower之前，Leader挂了。<br>如上图，ZAB需要确保事务P2最终能够在所有的服务器上都被提交成功，否则将出现不一致。  </p>
<h4 id="2-2-2-ZAB协议需要确保丢弃那些只在Leader服务器上被提出的事务"><a href="#2-2-2-ZAB协议需要确保丢弃那些只在Leader服务器上被提出的事务" class="headerlink" title="2.2.2 ZAB协议需要确保丢弃那些只在Leader服务器上被提出的事务"></a>2.2.2 ZAB协议需要确保丢弃那些只在Leader服务器上被提出的事务</h4><p><img src="https://raw.githubusercontent.com/zzzvvvxxxd/Picture/master/hexo/ZAB%E5%B4%A9%E6%BA%83%E6%81%A2%E5%A4%8D2.JPG" alt="崩溃恢复2"><br>如果在崩溃恢复过程中出现一个需要被丢弃的提案，那么在崩溃恢复后需要跳过该事物。<br>如上图，Leader(Server1)在提出P3后崩溃退出，其他机器都没有收到P3，于是当Server1恢复后，ZAB需要确保其丢弃事务P3。   </p>
<h3 id="2-3-选举算法"><a href="#2-3-选举算法" class="headerlink" title="2.3 选举算法"></a>2.3 选举算法</h3><p>以上决定了ZAB需要设计这一个Leader算法：</p>
<blockquote>
<p>能够确保提交已经被Leader提交的事务Proposal，丢弃已经被跳过的Proposal</p>
</blockquote>
<p>选举出来的Leader具有最高<code>ZXID</code>，保证了新的Leader一定具有所有已经提交的提案，也省去了检查Proposal的提交和丢弃的工作。  </p>
<h2 id="三、数据同步"><a href="#三、数据同步" class="headerlink" title="三、数据同步"></a>三、数据同步</h2><h3 id="3-1-正常的数据恢复流程"><a href="#3-1-正常的数据恢复流程" class="headerlink" title="3.1 正常的数据恢复流程"></a>3.1 正常的数据恢复流程</h3><p>Leader服务器会为每个Follower服务器准备一个队列，并将那些没有被各Follower服务器同步的事务以Proposal消息的形式逐个发送，并紧跟一个commit消息。等到Follower服务器将所有的尚未同步事务Proposal都从Leader服务器上同步过来并成功应用到内存数据库后，Leader服务器就会将该Follower加入到可用Follower列表中，开始后续流程。  </p>
<h3 id="3-2-如何处理需要被丢弃的事务Proposal"><a href="#3-2-如何处理需要被丢弃的事务Proposal" class="headerlink" title="3.2 如何处理需要被丢弃的事务Proposal"></a>3.2 如何处理需要被丢弃的事务Proposal</h3><p><code>ZXID</code>:<br>64位数字</p>
<ul>
<li>低32位看成是一个简单的递增计数器，针对每一个客户端请求，Leader每生成一个Proposal就会进行加1</li>
<li>高32位代表Leader周期epoch的编号，每当选举产生一个新的Leader，epoch+1，低32位同时恢复为0</li>
</ul>
<p>基于这样的策略，当一个包含了上一个Leader周期中没有提交的事务Proposal的服务器启动时，其肯定无法成为Leader，则以Follower角色连上当前的Leader服务器。Leader会根据自己服务器上最后提交的Proposal和Follower的Proposal进行比较，Leader会要求Follower进行一定的回退操作，回退到最后一个确认已经被过半机器提交的事务。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/22/ZAB2/" data-id="cj65v1lcy000rd7f9lc8h541o" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/一致性协议/">一致性协议</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分布式/">分布式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux进程&amp;线程命令" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/20/Linux进程&线程命令/" class="article-date">
  <time datetime="2016-08-20T09:36:53.000Z" itemprop="datePublished">2016-08-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/20/Linux进程&线程命令/">【Linux命令】照看好咱们的进程和线程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-查找占CPU最多的线程"><a href="#1-查找占CPU最多的线程" class="headerlink" title="1. 查找占CPU最多的线程"></a>1. 查找占CPU最多的线程</h3><p>步骤1： 查找出占用CPU最高的java线程pid<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">top -Hp 18207   #查看运行进程18207内所有线程的CPU消耗情况</div></pre></td></tr></table></figure></p>
<p>可以找到<code>%CPU</code>项最高的一个pid，就是该线程，假设pid是18250，将其转换为16进制：0x474a    </p>
<p>步骤2： jstack查看各个线程栈<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jstack 18207</div></pre></td></tr></table></figure></p>
<p>找到nid为0x474a的线程栈信息，其中包含了该线程的name，OK定位到了   </p>
<h3 id="2-查看一个进程运行了多久"><a href="#2-查看一个进程运行了多久" class="headerlink" title="2. 查看一个进程运行了多久"></a>2. 查看一个进程运行了多久</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ps -p &#123;PID-HERE&#125; -o etime</div><div class="line">ps -p &#123;PID-HERE&#125; -o etimes</div><div class="line">ps -p &#123;PID-HERE&#125; -o etime=</div><div class="line">ps -p &#123;PID-HERE&#125; -o etimes=</div></pre></td></tr></table></figure>
<p>实际上可以打印的信息有很多：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -p 6176 -o pid,cmd,etime,uid,gid</div></pre></td></tr></table></figure></p>
<h3 id="3-统计一个进程的线程数"><a href="#3-统计一个进程的线程数" class="headerlink" title="3. 统计一个进程的线程数"></a>3. 统计一个进程的线程数</h3><p>方法1： <code>ps</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps hH p &lt;pid&gt; | wc -l</div></pre></td></tr></table></figure></p>
<p>方法2：<code>/proc</code><br>proc 伪文件系统，它驻留在 /proc 目录，这是最简单的方法来查看任何活动进程的线程数。 /proc 目录以可读文本文件形式输出，提供现有进程和系统硬件相关的信息如 CPU、中断、内存、磁盘等等<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /proc/&lt;pid&gt;/status</div></pre></td></tr></table></figure></p>
<p>上面的命令将显示进程 <pid> 的详细信息，包括过程状态（例如, sleeping, running)，父进程 PID，UID，GID，使用的文件描述符的数量，以及上下文切换的数量</pid></p>
<h3 id="4-查看某个进程的线程"><a href="#4-查看某个进程的线程" class="headerlink" title="4. 查看某个进程的线程"></a>4. 查看某个进程的线程</h3><p>方法1：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -T -p &lt;pid&gt;</div></pre></td></tr></table></figure></p>
<blockquote>
<p><code>SID</code>栏表示线程ID，而<code>CMD</code>栏则显示了线程名称</p>
</blockquote>
<p>方法2：<br><code>top</code>可以使用<code>-H</code>开启线程查看模式，如果要查看特定进程的线程：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">top -H -p &lt;pid&gt;</div></pre></td></tr></table></figure></p>
<p>方法3：<br>要在<code>htop</code>中启用线程查看，请开启<code>htop</code>，然后按<code>&lt;F2&gt;</code>来进入<code>htop</code>的设置菜单。选择“设置”栏下面的“显示选项”，然后开启<code>树状视图</code>和<code>显示自定义线程名</code>选项。按<code>&lt;F10&gt;</code>退出设置<br>Htop的具体使用后续会专门写一篇记录一下。  </p>
<h3 id="5-查看进程被运行在哪个CPU上"><a href="#5-查看进程被运行在哪个CPU上" class="headerlink" title="5. 查看进程被运行在哪个CPU上"></a>5. 查看进程被运行在哪个CPU上</h3><p>方法1：<code>taskset</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">taskset -c -p &lt;pid&gt;</div></pre></td></tr></table></figure></p>
<p>方法2：<code>ps</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -o pid,psr,comm -p pid</div></pre></td></tr></table></figure></p>
<p>方法3：<code>top</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">top -p &lt;pid&gt; # 好处是可以持续观察</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/20/Linux进程&线程命令/" data-id="cj65v1lcm000ed7f9godmvzpn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZAB" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/09/ZAB/" class="article-date">
  <time datetime="2016-08-09T08:34:47.000Z" itemprop="datePublished">2016-08-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/分布式/">分布式</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/09/ZAB/">【一致性协议04】 ZAB协议概述</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>所有事务请求必须由一个全局唯一的服务器来协调处理,这样的服务器被成为Leader服务器,而余下的服务器则成为Follower服务器.<br>Leader服务器负责将一个客户端请求转换成一个事务Proposal(提议),并分发给所有的Follower服务器.之后Leader服务器需要等待所有Follower服务器的反馈,一旦超过半数的Follower进行了正确反馈后,那么Leader就会向所有的Follower服务器分发commit消息,要求将前一个Proposal进行提交</p>
<p>整个ZAB协议主要包括消息广播和崩溃恢复两个过程，进一步可以分为三个阶段，分别是：</p>
<ul>
<li>发现 <code>Discovery</code></li>
<li>同步 <code>Synchronization</code></li>
<li>广播 <code>Broadcast</code><br>组成ZAB协议的每一个分布式进程，都会循环执行这三个阶段，将这样一个循环称为一个主进程周期。</li>
</ul>
<h3 id="整个服务框架在启动过程中"><a href="#整个服务框架在启动过程中" class="headerlink" title="整个服务框架在启动过程中"></a>整个服务框架在启动过程中</h3><h3 id="Leader服务器出现网络中断、崩溃退出与重启等异常情况"><a href="#Leader服务器出现网络中断、崩溃退出与重启等异常情况" class="headerlink" title="Leader服务器出现网络中断、崩溃退出与重启等异常情况"></a>Leader服务器出现网络中断、崩溃退出与重启等异常情况</h3><p>ZAB协议就会进入崩溃恢复模式，选举新的Leader服务器。当选举产生新的Leader服务器，同时集群中已有过半的机器与该Leader完成了状态同步之后，ZAB就会退出恢复模式<br>状态同步是指数据同步，用来保证集群有过半的机器能够和Leader服务器数据状态保持一致。   </p>
<blockquote>
<p>集群中有过半的Follower和Leader完成了状态同步，那么服务框架就可以进入消息广播模式。</p>
</blockquote>
<h3 id="新加入一台机器"><a href="#新加入一台机器" class="headerlink" title="新加入一台机器"></a>新加入一台机器</h3><p>当一台遵守ZAB协议的服务器启动后加入到集群中，如果此时集群中已经存在一个Leader服务器在负责进行消息广播，那么新加入的服务器会自觉进入数据恢复模式：<br>    找到Leader所在的服务器，与其进行数据同步，然后一起参与到消息广播流程中。</p>
<h3 id="Leader服务器"><a href="#Leader服务器" class="headerlink" title="Leader服务器"></a>Leader服务器</h3><p>Leader在收到客户端的事务请求后，会生成对应的Proposal并发起一轮广播协议；而如果集群中其他机器接收到客户端的事务请求，那么这些非Leader服务器首先会将这个事务请求转发给Leader服务器。   </p>
<h3 id="消息广播-–-gt-崩溃恢复模式"><a href="#消息广播-–-gt-崩溃恢复模式" class="headerlink" title="消息广播 –&gt; 崩溃恢复模式"></a>消息广播 –&gt; 崩溃恢复模式</h3><p>（Leader服务器出现崩溃退出或机器重启，亦或时集群中已经不存在过半的服务器与Leader正常通信）<br>这种情况下，在开始新一轮的原子广播事务之前，所有进程需要使用崩溃恢复协议来让彼此达到一致的状态，于是ZAB的流程就会从消息广播模式进入到崩溃恢复模式。</p>
<h3 id="选举Leader"><a href="#选举Leader" class="headerlink" title="选举Leader"></a>选举Leader</h3><p>一个进程要成为新的Leader，必须获得过半的支持。进入崩溃恢复模式后，只要集群中存在过半的机器能够彼此通信，那么就可以产生一个新的Leader，进入消息广播模式<br>例子：<br>一个由3台机器组成的ZAB服务，通常由一个Leader，2个Follower组成。某一个时刻，其中一个Follower服务器挂了，整个ZAB不会中断服务，因为Leader服务器依然能够获取过半机器（包括自己）的支持</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/09/ZAB/" data-id="cj65v1lcv000md7f9m5tbojss" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/一致性协议/">一致性协议</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分布式/">分布式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Paxos" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/08/Paxos/" class="article-date">
  <time datetime="2016-08-08T13:43:21.000Z" itemprop="datePublished">2016-08-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/分布式/">分布式</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/08/Paxos/">【一致性协议03】 Paxos和分布式系统</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="资源汇总"><a href="#资源汇总" class="headerlink" title="资源汇总"></a>资源汇总</h2><ul>
<li><a href="http://research.microsoft.com/en-us/um/people/lamport/pubs/paxos-simple.pdf" target="_blank" rel="external">Paxos Made Simple</a></li>
<li><a href="http://mp.weixin.qq.com/s?__biz=MzA4MzYxMjEwMg==&amp;mid=203432378&amp;idx=1&amp;sn=34d280eb89d6bad352fdbbf856d86c99#rd" target="_blank" rel="external">使用Basic-Paxos协议的日志同步与恢复</a></li>
<li><a href="http://drmingdrmer.github.io/tech/distributed/2015/11/11/paxos-slide.html" target="_blank" rel="external">可靠分布式系统基础 Paxos 的直观解释</a></li>
<li><a href="http://www.tudou.com/programs/view/e8zM8dAL6hM/" target="_blank" rel="external">paxos和分布式系统(视频)</a></li>
</ul>
<h2 id="Paxos和分布式存储系统（问题定义）"><a href="#Paxos和分布式存储系统（问题定义）" class="headerlink" title="Paxos和分布式存储系统（问题定义）"></a>Paxos和分布式存储系统（问题定义）</h2><p>Paxos用来确定一个不可变变量的取值</p>
<ul>
<li>取值可以是任意二进制数据</li>
<li>一旦确定将不再更改，并且可以被获取到（不可变性、可读取性）</li>
</ul>
<p>在分布式存储系统中应用Paxos</p>
<ul>
<li>在分布式存储系统中，数据本身可变，采用多部分进行存储</li>
<li>多个副本的更新操作序列<code>[op1, op2, op3, ... , opn]</code>是相同的、不变的。</li>
<li>用Paxos依次来确定不可变变量<code>opi</code>的取值（即第i个操作时什么）</li>
<li>每确定完Opi之后，让各个数据副本执行<code>opi</code></li>
</ul>
<p>将问题转换为，设计一个系统，来存储名称为var的变量</p>
<blockquote>
<ul>
<li>系统内部由多个<code>Acceptor</code>组成，负责存储和管理<code>var</code>变量</li>
<li>外部有多个<code>proposer</code>机器任意并发调用API，向系统提交不同的<code>var</code>取值</li>
<li>var可以是任意二进制数据</li>
<li>系统对外的API库接口为：<ul>
<li><code>propose(var, V)</code>返回<code>&lt;ok, f&gt;</code>或者<code>&lt;error&gt;</code>（f是系统内部已经确定的取值，如果propose设置成功则f为V，否则为其他<code>proposer</code>设置成功的结果）</li>
</ul>
</li>
</ul>
</blockquote>
<p>系统要保证var的取值满足一致性</p>
<ul>
<li>如果<code>var</code>的取值没有确定，则var的取值为<code>null</code></li>
<li>一旦<code>var</code>的取值被确定，则不可更改。并且一直可以获取到这个值</li>
</ul>
<p>系统要满足一定的容错特性</p>
<ul>
<li>可以容忍任意<code>proposer</code>机器出现故障</li>
<li>可以容忍少数<code>Acceptor</code>故障（半数以下）</li>
</ul>
<p>暂时不考虑：</p>
<ul>
<li>网络分化</li>
<li><code>Acceptor</code>故障会丢失<code>var</code></li>
</ul>
<h2 id="难点"><a href="#难点" class="headerlink" title="难点"></a>难点</h2><p>分布式环境下确定一个不可变变量的难点有：</p>
<ul>
<li>管理多个<code>Proposer</code>的并发执行</li>
<li>保证<code>var</code>变量的不可变性</li>
<li>容忍任意<code>Proposer</code>机器故障</li>
<li>容忍半数以下<code>Acceptor</code>机器故障</li>
</ul>
<h2 id="方案1"><a href="#方案1" class="headerlink" title="方案1"></a>方案1</h2><p>先考虑由单个<code>Acceptor</code>组成，通过类似<strong>互斥锁机制</strong>来管理并发的<code>Proposer</code>运行</p>
<ul>
<li><code>Proposer</code>首相向<code>Acceptor</code>申请<code>Acceptor</code>的互斥访问权限，然后才能请求<code>Acceptor</code>接受自己的取值</li>
<li><code>Acceptor</code>给<code>Proposer</code>发放互斥访问权，谁申请到互斥访问权，就接受谁提交的值</li>
</ul>
<p>这样就让<code>Proposer</code>按照获取互斥访问权的顺序依次访问<code>Acceptor</code>，一旦<code>Acceptor</code>接收了某个<code>Proposer</code>的取值，则认为<code>var</code>取值被确定<br>，其他<code>Proposer</code>不再更改。</p>
<p>基于互斥访问权的<code>Acceptor</code>的实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Acceptor保存变量var和一个互斥锁lock</div><div class="line"></div><div class="line">Acceptor::prepare():</div><div class="line">    加互斥锁，给予var的互斥访问权，并返回当前的var取值f</div><div class="line"></div><div class="line">Acceptor::relaese():</div><div class="line">    解互斥锁，收回var的互斥访问权</div><div class="line"></div><div class="line">Acceptor::acceptor(var, V)</div><div class="line">    如果已经加锁，并且var没有取值，则设置var为V，并且释放锁</div></pre></td></tr></table></figure></p>
<p>Proposer(var, V)的两阶段实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">第一阶段：通过Acceptor::prepare()获取互斥访问权和当前var的取值</div><div class="line">    如果不能，返回&lt;error&gt;（锁被其他Proposer占用）</div><div class="line"></div><div class="line">第二阶段：根据当前var的取值f，选择执行</div><div class="line">    如果f为null，则通过Acceptor::accept(var, V)提交数据V</div><div class="line">    如果f不会null，则通过Acceptor::release()释放访问权，返回&lt;ok,f&gt;</div></pre></td></tr></table></figure></p>
<p><strong>缺陷</strong>：</p>
<blockquote>
<p>如果Proposer在释放互斥锁之前发生故障，会导致系统陷入死锁。（不能容忍任何Proposer机器故障）</p>
</blockquote>
<h2 id="方案2"><a href="#方案2" class="headerlink" title="方案2"></a>方案2</h2><p>引入抢占式访问权<br><code>Acceptor</code>可以让某个<code>Proposer</code>获取到的访问权失效，不再接收它的访问。之后，可以将访问权交给其他<code>Proposer</code>，让其他<code>Proposer</code>访问<code>Acceptor</code><br><code>Proposer</code>向<code>Acceptor</code>申请访问权时，指定编号<code>epoch</code>，并认为越大的<code>epoch</code>值越新，获取到访问权后，才能向<code>Acceptor</code>提交值。<br><code>Acceptor</code>采取<strong>喜新厌旧</strong>原则：</p>
<ul>
<li>一旦接收到更新的<code>epoch</code>申请，马上让之前的旧<code>epoch</code>访问权限失效，不再接收它们提交的取值</li>
<li>给新的<code>epoch</code>发放访问权，只接受新<code>epoch</code>提交的取值</li>
</ul>
<p>也就是新的<code>epoch</code>可以抢占旧的<code>epoch</code>，为了保持一致性，不同<code>epoch</code>的<code>Proposer</code>之间采<strong><em>后者认同前者</em></strong>的原则。</p>
<ol>
<li>肯定旧的<code>epoch</code>无法生成确定性取值时，新的<code>epoch</code>会提交自己的value，不会冲突</li>
<li>一旦旧<code>epoch</code>形成了确定性取值，新的<code>epoch</code>可以获取到该值，并会认同，而不会破坏</li>
</ol>
<p>基于抢占式访问权的<code>Acceptor的实现</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Acceptor保存的状态</div><div class="line">    当前var的取值&lt;accepted_epoch, accepted_value&gt;</div><div class="line">    最新发放访问权的epoch(lastest_prepared_epoch)</div><div class="line"></div><div class="line">Acceptor::prepare(epoch)</div><div class="line">    只接受比latest_prepared_epoch更大的epoch，并给予访问权</div><div class="line">    记录latest_prepared_epoch = epoch；返回当前var取值</div><div class="line"></div><div class="line">Acceptor::accept(vae, prepared_epoch, V)</div><div class="line">    验证latest_prepared_epoch == prepared_epoch,如果不等则说明已经有一个更新的epoch抢占了访问权</div><div class="line">    设置var的取值&lt;accepted_epoch, accepted_value&gt; = &lt;prepared_epoch, V&gt;</div></pre></td></tr></table></figure></p>
<p>Propose(var, V)的两阶段实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">第一阶段：获取epoch轮次的访问权和当前var的取值</div><div class="line">    简单选取当前时间戳为epoch，通过Acceptor::prepare(epoch)，获取epoch轮次的访问权和当前的var</div><div class="line">    如果不能获取返回&lt;error&gt;，Proposer运行失效</div><div class="line"></div><div class="line">第二阶段：采用&quot;后者认同前者&quot;原则执行</div><div class="line">    1. 如果var的取值为null，则肯定旧epoch无法生成确定性取值，则通过Acceptor::accept(var, epoch, V)提交数据。</div><div class="line">       成功后返回&lt;ok, V&gt;</div><div class="line">       如果accept失败，则返回&lt;error&gt;(被新的epoch抢占，或者Acceptor故障)</div><div class="line">    2. 如果var取值存在，则此确定值肯定是确定性取值，此时认同它不再更改，直接返回&lt;ok, accepted_value&gt;</div></pre></td></tr></table></figure></p>
<p><strong>总结</strong>：<br>基于抢占式访问权的核心思想让Proposer将epoch递增的顺序抢占式的依次运行，后者会认同前者。<br>【优点】：<br>可以避免方案一种Proposer故障带来的死锁问题，并且仍可以保证var取值的一致性<br>【缺点】：<br>单点问题任然存在</p>
<h2 id="Paxos"><a href="#Paxos" class="headerlink" title="Paxos"></a>Paxos</h2><p>Paxos就是在方案二的基础上，试图解决<code>Acceptor</code>的单点问题，引入了多<code>Acceptor</code>。仍然采用喜新厌旧的原则，但是<br>因为引入了多个<code>Acceptor</code>，则不再简单地”后者认同前者”，还采用了”少数服从多数”原则：</p>
<blockquote>
<p>一旦某个epoch的取值f被半数以上的Acceptor接受，则认为此var的取值确定为f，不再更改。</p>
</blockquote>
<p>Paxos中的<code>Acceptor</code>实现相较方案二保持不变。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Propose(var, V)第一阶段： 选定epoch，获取epoch访问权和对应的var取值</div><div class="line">    获取半数以上Acceptor的访问权和对应一组var取值</div><div class="line">    和方案二一致</div><div class="line"></div><div class="line">Propse(var, V)第二阶段： 采用后者服从前者的原则</div><div class="line">    # 在肯定旧epoch无法生成确定性取值时，新的epoch会提交自己的取值，不会冲突</div><div class="line">    # 一旦旧epoch形成确定性取值，新的epoch肯定可以获取到此取值，并且会认同此取值，不会破坏</div><div class="line">    1. 如果获取的var都为空，则旧epoch无法形成确定性取值，此时努力使&lt;epoch, V&gt;成为确定性取值</div><div class="line">        * 向epoch对应的所有Acceptor提交取值&lt;epoch, V&gt;</div><div class="line">        * 如果收到半数以上的成功，则返回&lt;ok, V&gt;</div><div class="line">        * 否则返回&lt;error&gt;（新epoch抢占或者Acceptor故障）</div><div class="line">    2. 如果获取的var取值存在，直接认同最大accepted_epoch对应的取值f，努力使&lt;epoch, f&gt;成为确定性取值</div><div class="line">        * 如果f出现半数以上，则说明f已经是确定性取值，直接返回&lt;ok, f&gt;</div><div class="line">        * 否则，向epoch对应的所有Acceptor提交取值&lt;epoch, f&gt;</div></pre></td></tr></table></figure>
<p><strong>总结</strong>：<br>核心思想：在抢占式访问（方案2）的基础上引入了多Acceptor，保证一个epoch，只有一个Proposer运行，Proposer按照递增的<br>次序运行。<br>新epoch的Proposer采用后者认同前者的思路运行。</p>
<blockquote>
<p>Paxos算法可以满足容错性要求。</p>
<ul>
<li>半数以下的Acceptor出现故障时，存货的Acceptor依然可以生成var的确定性取值</li>
<li>一旦var的值被确定，即使出现半数以下的Acceptor故障，此取值可以被获取，且不再被更改。</li>
</ul>
</blockquote>
<h2 id="Paxos算法的Liveness问题"><a href="#Paxos算法的Liveness问题" class="headerlink" title="Paxos算法的Liveness问题"></a>Paxos算法的Liveness问题</h2><p>新轮次的抢占会让旧轮次停止运行，如果每一轮在第二阶段执行成功之前都被新一轮次抢占，则导致活锁。如何解决？</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/08/Paxos/" data-id="cj65v1lcr000ld7f9ddacpif0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/一致性协议/">一致性协议</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分布式/">分布式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-DirectByteBuffer" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/22/DirectByteBuffer/" class="article-date">
  <time datetime="2016-07-22T13:03:11.000Z" itemprop="datePublished">2016-07-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JVM/">JVM</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/22/DirectByteBuffer/">【天池比赛日记 - 2】MaxDirectMemorySize和堆外内存</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近在做阿里的中间件比赛，在第二题的背景下，我们的方案需要一个基于磁盘的map和B+索引，显然IO就成为了瓶颈之一。为了提升IO的速度，我们选择<code>MappedByteBuffer</code>和<code>channel.map()</code>作为我们的IO处理方案。但是这样的方案存在一个问题，堆外内存不受JVM的控制，可能会因为一些原因导致JVM Crash，所以对这个问题做一点必要的研究。</p>
<h2 id="1-首先"><a href="#1-首先" class="headerlink" title="1. 首先"></a>1. 首先</h2><p>首先，根据JDK中对<code>MappedByteBuffer</code>的说明：  </p>
<blockquote>
<p>A direct byte buffer whose content is a memory-mapped region of a file.<br>Mapped byte buffers are created via the FileChannel.map method. This class extends the ByteBuffer class with operations that are specific to memory-mapped file regions.  </p>
</blockquote>
<p><code>MappedByteBuffer</code>本质上就一种继承了<code>ByteBuffer</code>的direct byte buffer，是分配在JVM堆外的内存。因而也就不受JVM的控制，也只有在full gc的时候才会被回收。<br>虽然，堆外内存包含了：</p>
<ul>
<li>jvm本身在运行过程中分配的内存</li>
<li>codecache</li>
<li>jni里分配的内存</li>
<li>DirectByteBuffer分配的内存</li>
</ul>
<p>我们在比赛过程中更关注的是DirectByteBuffer所产生的堆外内存，包括它的配置和回收等操作。  </p>
<h2 id="2-然后"><a href="#2-然后" class="headerlink" title="2. 然后"></a>2. 然后</h2><p>【比赛陷入僵局，结束了再续写】</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/07/22/DirectByteBuffer/" data-id="cj65v1lc20004d7f9zut6v2fb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JVM/">JVM</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-稀疏文件和文件空洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/21/稀疏文件和文件空洞/" class="article-date">
  <time datetime="2016-07-21T13:03:11.000Z" itemprop="datePublished">2016-07-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JVM/">JVM</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/21/稀疏文件和文件空洞/">【天池比赛日记 - 1】稀疏文件和文件空洞</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="log"><a href="#log" class="headerlink" title="log"></a>log</h4><p>在Linux和Windows下，我们都曾试图通过<code>fileChannel.map</code>来使用稀疏文件构建<code>&lt;Long, Long&gt;</code>和<code>&lt;Long, String&gt;</code>磁盘map方案。发现，在Windows下，系统和JVM对稀疏文件和<code>MappedByteBuffer</code>支持的更好，在Linux下我们使用了6个线程并发插入（我们的方案是模拟ConcurrentHashMap完成的线程安全map）的情况下，才达到Windows下单线程的构建速度。显然，这是操作系统实现决定的。而且，发现在文件大小小于4GB时，Linux速度较为出色，但是大于4GB就远远逊色于Windows。</p>
<p>另外，我们试图提前构建好空白文件（写入全量的0），但并没有拯救我们的map在Linux下的性能。所以，也导致了后期切换了Map的方案（做到了200s并发插入3亿索引数据）（后面会详细介绍，我们map的实现过程，和实现多线程和Page Cache的思路）。</p>
<h4 id="文件空洞"><a href="#文件空洞" class="headerlink" title="文件空洞"></a>文件空洞</h4><p>在unix文件操作中，文件位移量可以大于文件的当前长度。这种情况下，对该文件的下一次写将延长该文件，并在该文件中构成一个空洞。位于文件中，但没有写过的字节都被假设为0。</p>
<blockquote>
<p>如果offset比文件的长度更大，下一个写操作就会将文件extend，造成文件空洞(hole)。没有实际写入文件的所有自己由重复的0表示，空洞是否占用磁盘由文件系统决定。</p>
</blockquote>
<h4 id="稀疏文件-Sparse-File"><a href="#稀疏文件-Sparse-File" class="headerlink" title="稀疏文件 Sparse File"></a>稀疏文件 Sparse File</h4><p>和普通文件基本相同，区别在于文件中的部分数据是全0，这部分数据不需要占用磁盘空间。<br><img src="https://raw.githubusercontent.com/zzzvvvxxxd/Picture/master/hexo/sf1.png" alt="1"></p>
<h4 id="inode数据块存储"><a href="#inode数据块存储" class="headerlink" title="inode数据块存储"></a>inode数据块存储</h4><p>索引节点采用了多重索引结构，体现在直接指针和三个间接指针，直接指针包含12个直接指针块，直接指向包含文件数据的数据块，紧跟在后面的三个间接指针是为了适应文件的大小变化而设计的</p>
<blockquote>
<p>stat命令可以查看某个文件的inode信息</p>
</blockquote>
<p>inode会消耗磁盘空间，所以os一般将硬盘分为两个区域，数据区和inode区。每个inode大小一般是128/256byte</p>
<blockquote>
<p>sudo dumpe2fs -h /dev/hda | grep “Inode size”  # 查看inode节点大小</p>
</blockquote>
<p>由于每个文件都必须有一个inode，所以可能出现inode耗尽，但是磁盘未满的情况，此时已经无法创建新的文件。</p>
<p><img src="https://raw.githubusercontent.com/zzzvvvxxxd/Picture/master/hexo/sf2.png" alt="2"></p>
<p>文件系统存储稀疏文件时，inode索引节点中只给出实际占用磁盘空间的Block号，数据全0且不占用磁盘空间的文件Block没有物理磁盘Block号。</p>
<blockquote>
<p>文件所占用的磁盘空间仍然是连续的</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/zzzvvvxxxd/Picture/master/hexo/sf3.png" alt="3"></p>
<h2 id="多重索引"><a href="#多重索引" class="headerlink" title="多重索引"></a>多重索引</h2><p>Linux文件系统数据结构存放采用inode多重索引结构，有直接指针，和3个间接指针。</p>
<ul>
<li>直接指针直接指向保存出具的Block<blockquote>
<p>12个，若Block大小为4096Byte，则可以保存48KB文件</p>
</blockquote>
</li>
<li>一级指针指向一个Block，该Block中的数据是Block指针，指向真正数据Block<blockquote>
<p> 假设每个指针占用4个字节，则一级指针指向Block可以保存4096/4个指针，即1024个Blocks，算出一级指针可以保存的文件数据大小为4MB</p>
</blockquote>
</li>
<li>二级和三级类推<blockquote>
<p>二级: <code>(1024*1024)*4096=4GB</code> ; 三级: <code>(1024*1024*1024) * 4096 = 4TB</code></p>
</blockquote>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/07/21/稀疏文件和文件空洞/" data-id="cj65v1ldw001yd7f9v106el2s" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JVM/">JVM</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql_binlog2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/22/mysql_binlog2/" class="article-date">
  <time datetime="2016-06-22T01:44:17.000Z" itemprop="datePublished">2016-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/数据库/">数据库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/22/mysql_binlog2/">【mysql】binlog详解(2) binlog格式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>可以指定三种binary log的格式（启动时指定）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">--binlog-format=STATEMENT</div><div class="line">--binlog-format=ROW</div><div class="line">--binlog-format=MIXED</div><div class="line">```  </div><div class="line">* `statement-based logging`： 基于SQL语句，Mysql5.6默认，某些语句和函数如UUID, LOAD DATA INFILE等在复制过程可能导致数据不一致甚至出错。  </div><div class="line">* `row-based logging`：基于行，记录影响table中每一行的事务，很安全，很安全。但是binlog会比其他两种模式大很多，在一些大表中清除大量数据时在binlog中会生成很多条语句，可能导致从库延迟变大。  </div><div class="line">* `mixed logging`：使用statement-based logging作为默认，但是日志模式可能会在某些情况下自动切换到row-based logging。  </div><div class="line"></div><div class="line">`statement-based logging`可能回带来复制上的安全问题：</div><div class="line">&gt; With statement-based replication, there may be issues with replicating nondeterministic statements. In deciding whether or not a given statement is safe for statement-based replication, MySQL determines whether it can guarantee that the statement can be replicated using statement-based logging. If MySQL cannot make this guarantee, it marks the statement as potentially unreliable and issues the warning, Statement may not be safe to log in statement format.  </div><div class="line">You can avoid these issues by using MySQL&apos;s row-based replication instead.</div><div class="line"></div><div class="line">除了开头提到的启动参数，binlog的格式还可以在运行时切换：</div></pre></td></tr></table></figure></p>
<h1 id="GLOBAL"><a href="#GLOBAL" class="headerlink" title="GLOBAL"></a>GLOBAL</h1><p>mysql&gt; SET GLOBAL binlog_format = ‘STATEMENT’;<br>mysql&gt; SET GLOBAL binlog_format = ‘ROW’;<br>mysql&gt; SET GLOBAL binlog_format = ‘MIXED’;</p>
<h1 id="SESSION"><a href="#SESSION" class="headerlink" title="SESSION"></a>SESSION</h1><p>mysql&gt; SET SESSION binlog_format = ‘STATEMENT’;<br>mysql&gt; SET SESSION binlog_format = ‘ROW’;<br>mysql&gt; SET SESSION binlog_format = ‘MIXED’;<br>```</p>
<p>一般基于以下几个理由会设置<code>SESSION</code>级别的binlog format切换：</p>
<ul>
<li>在对数据库做出了很多小的改变时，可能会需要使用 row-based logging  </li>
<li>在使用<code>WHERE</code>进行更新操作时，可能会影响很多行记录，使用statement-based logging来记录少量的事务语句日志，会比记录很多行的改动有效得多。  </li>
<li>有些语句可能需要执行很长时间，但是实际只改动几行记录。使用row-based logging会对复制功能比较友好。  </li>
</ul>
<p>有些情况切换logging format可能会返回<code>error</code>:</p>
<ol>
<li>在使用InnoDB时，如果隔离级别是<code>READ COMMITTED</code>或<code>READ UNCOMMITTED</code>，只有row-based format可以使用。切换到statement-based其实也是可行的，但是很加就会导致错误，因为这种情况下InnoDB就无法插入数据  </li>
<li>临时表存在时，不推荐切换logging format<blockquote>
<p>Switching the replication format at runtime is not recommended when any temporary tables exist, because temporary tables are logged only when using statement-based replication, whereas with row-based replication they are not logged. With mixed replication, temporary tables are usually logged; exceptions happen with <code>user-defined functions (UDFs)</code> and with the <code>UUID()</code> function.</p>
</blockquote>
</li>
</ol>
<p>注意：<br><code>ROW</code>格式下依然会有部分的语句按照<code>STATEMENT</code>格式记录，例如所有的DDL语句：<code>CREATE TABLE</code>, <code>ALTER TABLE</code>和 <code>DROP TABLE</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/22/mysql_binlog2/" data-id="cj65v1ldu001vd7f9qnzr4ho1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-霸面" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/12/霸面/" class="article-date">
  <time datetime="2016-05-12T08:12:11.000Z" itemprop="datePublished">2016-05-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/日记/">日记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/12/霸面/">阿里霸面的事</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>我一定要5年内进入阿里的中间件团队，再做一次infoq讲师<br>今年4月12日的时候，我很郑重的对同学们说过这句话。今天是5月12日，恰好一个月。</p>
<p>今天是阿里实习校招的上海站。<br>距离我之前实习内推失败也有1月有余。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/12/霸面/" data-id="cj65v1lf5004rd7f9ago1kgn3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/日记/">日记</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-算法-trie树" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/06/算法-trie树/" class="article-date">
  <time datetime="2016-04-06T05:28:11.000Z" itemprop="datePublished">2016-04-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/多线程系列/">多线程系列</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/06/算法-trie树/">Trie树</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Trie树模板"><a href="#Trie树模板" class="headerlink" title="Trie树模板"></a>Trie树模板</h2><p>题目来源：<a href="http://hihocoder.com/problemset/problem/1014" target="_blank" rel="external">http://hihocoder.com/problemset/problem/1014</a>  </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">enum</span> NODE_TYPE &#123;</div><div class="line">    COMPLETED,</div><div class="line">    UNCOMPLETED</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">class</span> TrieNode &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    TrieNode* childNodes[<span class="number">26</span>];</div><div class="line">    <span class="keyword">int</span> freq;</div><div class="line">    <span class="keyword">char</span> nodeChar;</div><div class="line">    <span class="keyword">enum</span> NODE_TYPE type;</div><div class="line">    TrieNode(<span class="keyword">char</span> ch) &#123;</div><div class="line">        <span class="keyword">this</span>-&gt;nodeChar = ch;</div><div class="line">        <span class="keyword">this</span>-&gt;freq = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</div><div class="line">            <span class="keyword">this</span>-&gt;childNodes[i] = <span class="literal">NULL</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">this</span>-&gt;type = UNCOMPLETED;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add_freq</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_type</span><span class="params">(<span class="keyword">enum</span> NODE_TYPE)</span></span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Trie &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    TrieNode* root;</div><div class="line">    Trie() &#123;</div><div class="line">        root = <span class="keyword">new</span> TrieNode(<span class="string">' '</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span> str)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">find</span><span class="params">(<span class="built_in">string</span> str)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="built_in">string</span> str)</span></span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">charToIndex</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> ch - <span class="string">'a'</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Trie::insert(<span class="built_in">string</span> str) &#123;</div><div class="line">    TrieNode *current_node = <span class="keyword">this</span>-&gt;root;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str.length(); i++) &#123;</div><div class="line">        <span class="keyword">int</span> index = charToIndex(str[i]);</div><div class="line">        <span class="keyword">char</span> ch = str[i];</div><div class="line">        <span class="keyword">if</span>(current_node-&gt;childNodes[index] == <span class="literal">NULL</span>) &#123;</div><div class="line">            current_node-&gt;childNodes[index] = <span class="keyword">new</span> TrieNode(ch);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        current_node-&gt;childNodes[index]-&gt;add_freq();</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(i == str.length()<span class="number">-1</span>) &#123;</div><div class="line">            current_node-&gt;childNodes[index]-&gt;set_type(COMPLETED);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(current_node-&gt;childNodes[index]-&gt;type != COMPLETED)&#123;</div><div class="line">            current_node-&gt;childNodes[index]-&gt;set_type(UNCOMPLETED);</div><div class="line">        &#125;</div><div class="line">        current_node = current_node-&gt;childNodes[index];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">bool</span> Trie::find(<span class="built_in">string</span> str) &#123;</div><div class="line">    TrieNode *current_node = <span class="keyword">this</span>-&gt;root;</div><div class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(i &lt; str.length()) &#123;</div><div class="line">        <span class="keyword">char</span> ch = str[i];</div><div class="line">        <span class="keyword">int</span> index = charToIndex(ch);</div><div class="line">        <span class="keyword">if</span>(current_node-&gt;childNodes[index] == <span class="literal">NULL</span>) &#123;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        i++;</div><div class="line">        current_node = current_node-&gt;childNodes[index];</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; current_node-&gt;nodeChar &lt;&lt; <span class="string">" "</span> &lt;&lt; current_node-&gt;type &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> current_node-&gt;type == COMPLETED &amp;&amp; i == str.length();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> Trie::query(<span class="built_in">string</span> str) &#123;</div><div class="line">    TrieNode *current_node = <span class="keyword">this</span>-&gt;root;</div><div class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> count;</div><div class="line">    <span class="keyword">while</span>(i &lt; str.length()) &#123;</div><div class="line">        <span class="keyword">char</span> ch = str[i];</div><div class="line">        <span class="keyword">int</span> index = charToIndex(ch);</div><div class="line">        <span class="keyword">if</span>(current_node-&gt;childNodes[index] == <span class="literal">NULL</span>) &#123;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        i++;</div><div class="line">        current_node = current_node-&gt;childNodes[index];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(i == str.length())&#123;</div><div class="line">        <span class="keyword">return</span> current_node-&gt;freq;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> TrieNode::set_type(<span class="keyword">enum</span> NODE_TYPE t) &#123;</div><div class="line">    <span class="keyword">this</span>-&gt;type = t;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> TrieNode::add_freq() &#123;</div><div class="line">    <span class="keyword">this</span>-&gt;freq++;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    Trie trie;</div><div class="line">    <span class="keyword">int</span> loop;</div><div class="line">    <span class="built_in">cin</span> &gt;&gt; loop;</div><div class="line">    <span class="keyword">while</span>(loop &gt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="built_in">string</span> str;</div><div class="line">        <span class="built_in">cin</span> &gt;&gt; str;</div><div class="line">        trie.insert(str);</div><div class="line">        loop--;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cin</span> &gt;&gt; loop;</div><div class="line">    <span class="keyword">while</span>(loop &gt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="built_in">string</span> str;</div><div class="line">        <span class="built_in">cin</span> &gt;&gt; str;</div><div class="line">        <span class="built_in">cout</span> &lt;&lt; trie.query(str) &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">        loop--;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/06/算法-trie树/" data-id="cj65v1lex004gd7f9fl6xu8kz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据结构/">数据结构</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/算法/">算法</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/atomic/">atomic</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式/">分布式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/多线程/">多线程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/多线程系列/">多线程系列</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/日记/">日记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/笔试/">笔试</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/一致性协议/">一致性协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式/">分布式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/多线程/">多线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/并发/">并发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/日记/">日记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/笔试/">笔试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/笔试面试/">笔试面试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JVM/" style="font-size: 16px;">JVM</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/mysql/" style="font-size: 12px;">mysql</a> <a href="/tags/一致性协议/" style="font-size: 14px;">一致性协议</a> <a href="/tags/分布式/" style="font-size: 14px;">分布式</a> <a href="/tags/多线程/" style="font-size: 18px;">多线程</a> <a href="/tags/并发/" style="font-size: 18px;">并发</a> <a href="/tags/数据库/" style="font-size: 12px;">数据库</a> <a href="/tags/数据结构/" style="font-size: 12px;">数据结构</a> <a href="/tags/日记/" style="font-size: 10px;">日记</a> <a href="/tags/笔试/" style="font-size: 10px;">笔试</a> <a href="/tags/笔试面试/" style="font-size: 10px;">笔试面试</a> <a href="/tags/算法/" style="font-size: 12px;">算法</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/03/03/Future/">(no title)</a>
          </li>
        
          <li>
            <a href="/2016/08/22/ZAB2/">【一致性协议05】 ZAB协议详细介绍</a>
          </li>
        
          <li>
            <a href="/2016/08/20/Linux进程&线程命令/">【Linux命令】照看好咱们的进程和线程</a>
          </li>
        
          <li>
            <a href="/2016/08/09/ZAB/">【一致性协议04】 ZAB协议概述</a>
          </li>
        
          <li>
            <a href="/2016/08/08/Paxos/">【一致性协议03】 Paxos和分布式系统</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 zzzvvvxxxd<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>